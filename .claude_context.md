# Claude Context File - Japanese Pangenome Pipeline
<!-- This file helps Claude restore context in future sessions -->
<!-- Last updated: 2026-02-04 -->

## Project Overview

This is a bioinformatics pipeline for the Japanese Pangenome Project. The user (Raul Mateos, rmateosr@ncc.go.jp) is processing 47 samples through a Flagger HiFi coverage analysis pipeline.

## Current State

### Completed
- [x] Reviewed flagger pipeline scripts (syntax validated, logic confirmed)
- [x] Organized scripts into logical directory structure
- [x] Initialized git repo and pushed to GitHub
- [x] Downloaded Flagger container (v1.1.0)
- [x] Configured pipeline paths in submission script
- [x] Validated manifest file (47 samples)
- [x] Ran direct test (DEBUG=1) - all validations passed
- [x] Submitted single-sample test job to SLURM

### In Progress
- [ ] Test job 14798218 running for sample NA18939
- [ ] Waiting for completion to verify full pipeline works

### Pending
- [ ] Submit all 47 samples once test succeeds
- [ ] Commit final changes to GitHub

## Key Paths

```
SCRIPTS_DIR=/lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/scripts
FLAGGER_DIR=$SCRIPTS_DIR/flagger_pipeline/slurm_hifi_flagger_pipeline_complete
CONTAINER=/lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/containers/flagger_v1.1.0.sif
OUTPUT_DIR=/lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/flagger_output
MANIFEST=/lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/required_data/Manifest/hap_manifestPacBio.tsv
INPUT_DATA=/lustre9/open/shared_data/visc/
```

## GitHub

- Repo: https://github.com/rmateosr/Japanese_Pangenome
- User: rmateosr
- Email: rmateosr@ncc.go.jp
- Auth: Personal Access Token (user has one configured)

## Pipeline Details

### Input
- Manifest TSV with columns: ID, fasta1_path, fasta2_path, HiFi_paths
- Haplotype assemblies: ~849 MB each (gzipped)
- HiFi reads: ~100 GB per sample (multiple FASTQ files)

### Output
- `minimap2_output/<ID>.mm2.sorted.bam`
- `minimap2_output_samtools_flagstat/<ID>.mm2.sorted.flagstat.txt`
- `minimap2_output_cram/<ID>.mm2.sorted.cram`
- `flagger_work/<ID>/covfilesHap_direct/<ID>.hap1.cov.gz`
- `flagger_work/<ID>/covfilesHap_direct/<ID>.hap2.cov.gz`

### SLURM Resources
- CPUs: 16
- Memory: 96G
- Time: 36:00:00
- Partition: epyc

## Commands to Resume

```bash
# Check if test job completed
squeue -j 14798218 || echo "Job finished"

# Check test outputs
ls -lh /lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/flagger_output/flagger_work/NA18939/covfilesHap_direct/

# If test succeeded, submit all 47 samples
cd /lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/scripts/flagger_pipeline/slurm_hifi_flagger_pipeline_complete
bash 00_submit_pipeline.sh /lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/required_data/Manifest/hap_manifestPacBio.tsv

# Commit changes to git
cd /lustre10/home/raulnmateos/Japanese_Pangenome/Pipeline/Figure_2/scripts
git add -A
git commit -m "Update flagger pipeline configuration"
git push origin main
```

## Notes for Claude

1. User is new to Claude Code - be helpful and explain things clearly
2. SLURM jobs may take time to start (Priority queue)
3. Direct tests on login node should be time-limited
4. Input data is on /lustre9, outputs on /lustre10
5. User prefers organized code and documentation
6. Obsidian-friendly markdown is appreciated

## Session History Summary

1. User asked to review flagger scripts in `slurm_hifi_flagger_pipeline_complete/`
2. Validated script syntax and identified required inputs
3. Confirmed manifest format matches script expectations
4. User decided on single GitHub repo (monorepo) for all pipeline scripts
5. Initialized git, organized directory structure, pushed to GitHub
6. Downloaded Flagger container from Docker Hub
7. Configured OUT_ROOT and FLAGGER_SIF paths
8. Ran direct test with DEBUG=1 (validated script logic)
9. Submitted single-sample test job (ID: 14798218)
10. Created documentation files (this one + SESSION_NOTES.md)
